# 数据集预处理

流程：  
1. 读取.bin文件（按照示例代码）和.json文件
2. 处理数据
3. 处理标签  
4. 切片
5. 保存

需要保留在代码前部分供人工设置的选项有：原始数据集目录、预处理后数据集的输出目录文件夹名称（默认名称你来确定）、取原始数据集的多少张图片进行预处理（取值i=0-7500则随机选择i个样本进行预处理，取值-1则全部预处理）

预处理后数据集的输出格式：  
在/data/hwh_data_folder/processed_datasets下新建一个文件夹，默认名称你来确定；  
在此文件夹下，建立三个文件夹，名称分别为images和labels和visual；  
将时频图结果（不切片/切片）保存在images文件夹中，将标签文件保存在labels文件夹中，预处理检查结果保存在visual文件夹中；  

时频图的保存形式：  
由于我要使用ultralytics框架训练，所以请你纵轴频率轴从上到下递增。  
使用R=G=B的灰度图，保存为.png格式  
处理时需要保留在代码前部分供人工设置的选项有：STFT的频率分辨率（默认5kHz）和窗重叠率（默认0.5）、时频图使用线性值还是dB值（默认线性值）、图像是否归一化以及是样本归一化还是全局归一化（默认全局归一化）、全局归一化的参数最大dB和最小dB（按dB设置，若前面选择线性则自动将其转为线性坐标）（默认-140dB和30dB）  

标签的保存形式：  
由于我要使用ultralytics框架训练，所以请你将标签保存为配套的.txt文件，每行代表一个目标信号。  
注意纵轴频率轴是从上向下递增的。  
处理时需要保留在代码前部分供人工设置的选项有：关注的信号种类（此参数以字典形式，类似{9:0.0523, 9:0.0625, 9:0.25, 10:0.3, 10:0.5, 11:1.6, 12:0.006, 12:0.2, 13:0.04, 13:0.12, 13:0.2}，其key为关注的信号种类，value是该信号下的要关注的带宽（单位MHz），即在此次数据集预处理时，只关注这些key对应下的这些带宽的信号，其它key的信号或着这些key下的其它带宽的信号均视为背景，在标签中不体现，比如一个class 3的信号虽然存在，但是因为我不关注，所以无需在标签中体现；又比如一个class 10的信号，但是它的带宽是10MHz，依然不关注）  

注意时频图和标签的名称需要对应。

切片：  
因为数据集中既存在宽带大信号，也存在窄带小信号，所以需要对数据集进行两种预处理；  
在针对窄带小信号预处理时，STFT的窗长度选取的较大，也就是时频图的纵轴较长，若直接输入ultralytics框架，则会自动缩放到imgsz，还是看不清窄带小信号。  
所以需要将时频图裁剪为纵轴640，横轴小于640的切片，保存为独立样本。  
切片的设置包括：是否切片（若针对宽带大信号做预处理，则无需切片）、切片纵轴长度（默认640，对于纵轴小于640的切片，横轴也可等于640，或小于640）、切片重叠度（20%）  
假如一张时频图的尺寸为(6000, 1000)，则先在纵轴上切片即0到640、640\*0.2到640\*1.2、...但是到最后512到1000只有488长度，那就只保留488长度，硬性保证重叠度为0.2；频率轴切片结束后，由于每个切片的横轴都是1000，大于640，所以进行切片，硬性保证重叠度为0.2；  
但是由于样本中目标信号是稀疏的，所以可能一个原始时频图在切片后得到十几个甚至数十个切片，但里面只有几个是有信号的（尤其是我还设定了关注的信号，即不是关注所有信号），所以将正切片（即非空切片）保存在images/positive文件夹中，将负切片（即空切片）保存在images/negative文件夹中；  
注意标签也需要对应切片。

预处理可视化检查：
随机选择10个时频图（若不切片，则在原本时频图中随机选择；若切片，则在正切片即非空切片中随机选择），画出带有标注了对应标签文件中的信号框的示意图，便于我可视化检查数据集预处理是否正确；